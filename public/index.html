<!DOCTYPE html>
<html>
    <head>
    <title>wikitweets</title>
    <link rel="stylesheet" href="/css/style.css">
    <script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="/js/underscore-min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Anonymous+Pro' rel='stylesheet' type='text/css'> 

    <script type="text/javascript">
    $(document).ready(main);

    var wikipediaTemplate = _.template('<article class="update"><article class="tweet"></article><article class="wikipediaArticle"><header><a href="<%= article.url %>"><img class="wikipediaIcon" src="/images/wikipedia.png"></a><a class="articleTitle" href="<%= article.url %>"><%= article.title %></a></header><div class="articleSummary"><%= article.summary %></div></article>');
     
    function main() {
      var socket = io.connect();
      socket.on('connect', function() {
        socket.on('tweet', function(tweet) {
          addTweet(tweet);
        });
      });
    }

    function addTweet(tweet) {
      tweet.textWithLinks = makeLinks(tweet.text);
      var tweetEl = $('<article class="tweet"></article>');
      twttr.widgets.createTweet(tweet.id, tweetEl)
        .then(function(el) {
          var item = $('<article class="update">' + tweetEl.prop('outerHTML') + wikipediaTemplate(tweet) + "<div class="clearUpdate"></div></article>");
          item.hide();
          var tweets = $("#tweets");
          tweets.prepend(item);
          item.slideDown();
          // remove old updates so the DOM doesn't bloat memory
          $("article.update:gt(100)").detach();
        });
    }
    </script>

    </head>
    <body>
        <!-- github banner -->
        <a href="http://github.com/edsu/wikitweets"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub" /></a> 
        <header id="sidebar">
            <pre>w
i
k
i
t
w
e
e
t
s</pre>
            <p>wikitweets is an experimental visualization of how wikipedia is cited on twitter</p>
            <p>to see how it works please see the <a href="http://github.com/edsu/wikitweets">wikitweets</a> project page on github</p>
        </header>
        <section id="tweets"></section>
    </body>
</html>
